# 솔리디티 기초

## 변수 저장 공간
- Storage: 블록체인 상에 영구적으로 저장되는 변수
- Memory: 임시적으로 저장되는 변수, 컨트랙트 함수에 대한 외부 호출이 이루어지면 지워짐. (자동선언)

\* **※그러나 함수 내의 구조체/배열 처리시 수동적으로 선언해주어야 함**

A(is B) 컨트랙트 내에서 B컨트랙트의 private 함수를 호출하는경우, 에러 발생

\* internal 함수 접근제어자 사용시, 자식이 사용가능함

생성자(Constructor): 컨트랙트와 동일한 이름을 가진, 생략 가능한 함수. 컨트랙트 생성시 한번만 실행됨

함수 제어자: modifier를 사용. 다른 함수들에 대한 접근을 제어하기 위해 사용되는 유사 함수. 함수실행 전 요구사항 충족여부 확인.

Ownable 컨트랙트: 검증받은 스마트 컨트랙트의 라이브러리. 대부분의 솔리디티 DApp에서는 해당 컨트랙트를 복붙하고 시작함. 첫 컨트랙트는 Ownable을 상속해서 만듦.

<br>
<br>

## 솔리디티 특징

### 1. GAS
DApp의 함수를 실행할 때마다 가스(Gas)라고 불리는 화폐를 지불해야 함
사람들은 이더(ETH)를 이용해서 가스를 구매함

\* 사용자가 DApp 함수를 실행하려면 이더를 소모

함수 실행 시 **얼마나 많은 가스가 필요**\*한지는 함수가 얼마나 복잡한지에 따라 달라짐

**가스비용(gas cost): 함수 연산수행 시 소모되는 컴퓨팅자원의 양에 따라 결정됨**

그러므로, 이더리움에서 코드 최적화는 타 프로그래밍 언어보다 훨씬 더 중요함. 비용이 소모되니까
만약 내 코드가 최적화되어 있지 않으면, 사용자들은 내 함수 사용하기 위해 비용을 더 내게 되는 것.

<br>
<br>

### 2. 가스가 필요한 이유
함수실행 시 네트워크상의 모든 개별 노드가 함수의 출력값을 검증하기 위해 해당 함수를 실행해야 함. 
    
이러한 수천개의 노드가 이더리움을 분산화하고, 데이터를 보존하는 요소임.

<br>

#### [+] 비용이 없다면? 
- 누군가 무한반복문을 써서 네트워크를 방해
- 자원 소모가 큰 연산을 사용해서 네트워크 자원을 모두 사용

\* 사용자들은 저장공간 뿐만아니라 연산사용 시간에 따라서도 비용을 지불해야 함

그러나 크립토좀비같은 사이드체인에서는 비용을 지불하지 않을 수 있다.

**사이드체인(sidechain) : 플랫폼 코인에 해당하는 이더리움 등의 메인체인 옆에 나란히 붙어서 작동하는 체인을 의미함. 사이드체인만의 독립된 노드를 구성하지 않고, 기존 메인체인의 노드에 사이드체인의 노드가 추가되는 방식으로 작동함.**

<br>
<br>

### 3. 가스를 아끼는 방법

#### 구조체 압축
uint에는 여러가지 타입이 있음 (uint8, uint16, uint32 등)

하위 타입을 사용하는 것은 아무런 의미가 없음.
솔리디티에서는 **uint의 크기와 상관없이 256bit의 저장공간을 미리 잡아놓기 때문임.**

그러나 **구조체 안에서는 예외**
구조체 안에 여러개의 uint를 만든다면, 작은 크기의 uint를 사용하자.

```sol:struct
struct NormalStruct{
    uint32 a;
    uint32 b;
    uint c;
}
```

<br>

#### 왜 구조체 안에서는 예외일까?

이는 스택과 메모리 할당 방식에 이유가 있다.

**EVM 스택**
- **함수 내에서 선언된 지역변수**가 저장
- EVM 스택 슬롯은 고정된 32byte(256bit) 크기를 가짐
- 따라서 **uint32와 uint 모두 동일한 32byte 슬롯을 사용함**

<br>

**EVM 메모리**
- **함수 내에서 동적으로 할당**되는 메모리는 EVM 메모리에 저장
- 메모리 할당은 byte 단위로 이루어지나, 메모리 접근 및 비용 계산은 32byte 단위로 최적화됨
- 따라서 **메모리에서 4byte(32bit)를 읽거나 쓸때도 32byte단위의 메모리 접근 비용이 발생함**
  - 이는 메모리할당 및 접근이 32byte 경계에서 이루어지기 때문이다.

<br>

**EVM 스토리지**
- 상태 변수는 EVM 스토리지에 저장되며, EVM 스토리지는 32byte 슬롯으로 관리됨
- 여기서 데이터 타입의 크기를 줄이면 슬롯을 효율적으로 사용할 수 있음

<br>

> **상태변수**<br>
> - 스마트 계약의 상태를 저장하는 변수. 계약이 배포되면 이더리움 블록체인의 스토리지에 저장되며, 계약의 전체 수명동안 유지됨. <br>
> - 솔리디티 계약의 지속적인 데이터를 저장하는 데 사용되며, 이러한 변수에 저장된 데이터는 트랜잭션 간에도 유지됨.


```
contract contractA {
    uint a;
    uint b;

    struct person{
        string name;
        int age;
    }
    ...
}
```

위 코드에서 변수 a,b와 person 구조체는 상태변수임.

